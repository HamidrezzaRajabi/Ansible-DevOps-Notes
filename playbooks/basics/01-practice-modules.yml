---
# Practice file for Ansible modules
# Run with: ansible-playbook -i ../inventory/hosts.ini 01-practice-modules.yml

- name: Module Practice Playbook
  hosts: all
  become: yes  # Run tasks with sudo
  
  tasks:
    # 1. Gather facts (implicitly done by playbooks)
    - name: Display OS family
      debug:
        msg: "This host is {{ ansible_os_family }}"
    
    # 2. File operations
    - name: Create directory structure
      file:
        path: "/tmp/ansible-{{ ansible_hostname }}"
        state: directory
        mode: '0755'
    
    - name: Create configuration file
      copy:
        content: |
          # Generated by Ansible
          host: {{ ansible_hostname }}
          date: {{ ansible_date_time.iso8601 }}
        dest: "/tmp/ansible-{{ ansible_hostname }}/config.txt"
        mode: '0644'
    
    # 3. Command execution
    - name: Get system info
      shell: |
        echo "CPU: $(nproc)"
        echo "Memory: $(free -h | grep ^Mem | awk '{print $2}')"
        echo "Disk: $(df -h / | awk 'NR==2 {print $2}')"
      register: system_info
    
    - name: Show system info
      debug:
        var: system_info.stdout_lines
    
    # 4. Fetch files (run on control node)
    - name: Fetch config files
      fetch:
        src: "/tmp/ansible-{{ ansible_hostname }}/config.txt"
        dest: "fetched/{{ ansible_hostname }}/"
        flat: yes
      run_once: yes
      delegate_to: localhost
...
